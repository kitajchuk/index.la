general:
    branches:
        only:
            - dev
            - master

machine:
    node:
        version: 6.1.0
    timezone:
        America/Los_Angeles

dependencies:
    cache_directories:
        - "node_modules"
    override:
        - npm install
        - npm update prismic-express
        - npm rebuild node-sass

test:
    override:
        - mkdir db
        - npm run webpack # lint, babel, sass
        - npm run sync
        - npm run build

deployment:
    staging:
        branch: dev
        commands:
            - make -f Circlefile deploy_staging
    production:
        branch: master
        commands:
            - make -f Circlefile deploy_production
